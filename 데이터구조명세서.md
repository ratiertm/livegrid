# LiveView Grid ë°ì´í„° êµ¬ì¡° ëª…ì„¸ì„œ

> **ë²„ì „**: v0.1.0  
> **ì‘ì„±ì¼**: 2026-02-20  
> **ìƒíƒœ**: Draft - êµ¬ì¡° í™•ì •

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [LiveView Assigns êµ¬ì¡°](#liveview-assigns-êµ¬ì¡°)
3. [Grid State êµ¬ì¡°](#grid-state-êµ¬ì¡°)
4. [Column êµ¬ì¡°](#column-êµ¬ì¡°)
5. [Filter State êµ¬ì¡°](#filter-state-êµ¬ì¡°)
6. [Sort State êµ¬ì¡°](#sort-state-êµ¬ì¡°)
7. [Selection State êµ¬ì¡°](#selection-state-êµ¬ì¡°)
8. [Pagination State êµ¬ì¡°](#pagination-state-êµ¬ì¡°)
9. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)

---

## ê°œìš”

LiveView GridëŠ” **ì„œë²„ ì‚¬ì´ë“œ ìƒíƒœ ê´€ë¦¬**ë¥¼ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤.  
ëª¨ë“  ìƒíƒœëŠ” LiveViewì˜ `assigns`ì— ì €ì¥ë˜ë©°, WebSocketì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì™€ ë™ê¸°í™”ë©ë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™:**
1. **Single Source of Truth**: ëª¨ë“  ìƒíƒœëŠ” ì„œë²„(assigns)ì— ì¡´ì¬
2. **Immutable State**: ìƒíƒœ ë³€ê²½ ì‹œ ìƒˆ ë§µ ìƒì„±
3. **Computed Values**: ê³„ì‚°ëœ ê°’ì€ í•„ìš” ì‹œ ë™ì  ê³„ì‚°
4. **Type Safety**: Typespecìœ¼ë¡œ íƒ€ì… ë³´ì¥

---

## LiveView Assigns êµ¬ì¡°

### ì „ì²´ êµ¬ì¡°ë„

```elixir
socket.assigns = %{
  # Grid ì¸ìŠ¤í„´ìŠ¤
  grid: %{
    # ë©”íƒ€ë°ì´í„°
    id: String.t(),
    version: String.t(),
    
    # ì›ë³¸ ë°ì´í„°
    raw_data: list(map()),
    
    # í˜„ì¬ í‘œì‹œ ë°ì´í„° (í•„í„°/ì •ë ¬ ì ìš© í›„)
    data: list(map()),
    
    # ì»¬ëŸ¼ ì •ì˜
    columns: list(column_spec()),
    
    # ìƒíƒœ
    state: grid_state(),
    
    # ì˜µì…˜
    options: grid_options()
  }
}
```

---

## Grid State êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type grid_state :: %{
  # ì •ë ¬ ìƒíƒœ
  sort: sort_state() | nil,
  
  # í•„í„° ìƒíƒœ
  filters: filter_state(),
  
  # ì„ íƒ ìƒíƒœ
  selection: selection_state(),
  
  # í˜ì´ì§€ë„¤ì´ì…˜ ìƒíƒœ
  pagination: pagination_state(),
  
  # í¸ì§‘ ìƒíƒœ
  editing: editing_state() | nil,
  
  # ë¡œë”© ìƒíƒœ
  loading: boolean(),
  
  # ì—ëŸ¬ ìƒíƒœ
  error: String.t() | nil
}
```

### ê¸°ë³¸ê°’

```elixir
default_state = %{
  sort: nil,
  filters: %{},
  selection: %{
    mode: :none,
    selected_ids: []
  },
  pagination: %{
    current_page: 1,
    page_size: 20,
    total_rows: 0
  },
  editing: nil,
  loading: false,
  error: nil
}
```

---

## Column êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type column_spec :: %{
  # í•„ìˆ˜ í•„ë“œ
  field: atom(),
  label: String.t(),
  
  # ë ˆì´ì•„ì›ƒ
  width: pos_integer() | :auto,
  min_width: pos_integer() | nil,
  max_width: pos_integer() | nil,
  align: :left | :center | :right,
  visible: boolean(),
  frozen: boolean(),
  
  # ê¸°ëŠ¥
  sortable: boolean(),
  filterable: boolean(),
  editable: boolean(),
  resizable: boolean(),
  
  # í¬ë§·
  format: format_spec() | nil,
  
  # í•„í„°
  filter: filter_config() | nil,
  
  # ì—ë””í„°
  editor: editor_config() | nil,
  
  # ì»¤ìŠ¤í…€ ë Œë”ëŸ¬
  renderer: function() | nil,
  
  # CSS í´ë˜ìŠ¤
  header_class: String.t() | nil,
  cell_class: String.t() | function() | nil
}
```

### ì˜ˆì‹œ

#### ê¸°ë³¸ í…ìŠ¤íŠ¸ ì»¬ëŸ¼

```elixir
%{
  field: :name,
  label: "ì´ë¦„",
  width: 150,
  align: :left,
  visible: true,
  frozen: false,
  sortable: true,
  filterable: true,
  editable: false,
  resizable: true
}
```

#### ìˆ«ì ì»¬ëŸ¼ (í¬ë§·íŒ…)

```elixir
%{
  field: :price,
  label: "ê°€ê²©",
  width: 120,
  align: :right,
  sortable: true,
  format: %{
    type: :number,
    decimals: 2,
    prefix: "$",
    thousand_separator: ","
  }
}
```

#### ì¡°ê±´ë¶€ ìŠ¤íƒ€ì¼ ì»¬ëŸ¼

```elixir
%{
  field: :status,
  label: "ìƒíƒœ",
  width: 100,
  align: :center,
  cell_class: fn row ->
    case row.status do
      :active -> "badge-green"
      :inactive -> "badge-gray"
      :pending -> "badge-yellow"
    end
  end
}
```

---

## Filter State êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type filter_state :: %{
  atom() => filter_value()
}

@type filter_value :: %{
  value: any(),
  operator: filter_operator(),
  active: boolean()
}

@type filter_operator ::
  # í…ìŠ¤íŠ¸
  :contains | :equals | :starts_with | :ends_with | :not_contains |
  # ìˆ«ì/ë‚ ì§œ
  :eq | :ne | :gt | :gte | :lt | :lte | :between |
  # ê¸°íƒ€
  :is_null | :is_not_null
```

### ì˜ˆì‹œ

#### ë‹¨ì¼ í•„í„°

```elixir
filters = %{
  name: %{
    value: "Alice",
    operator: :contains,
    active: true
  }
}
```

#### ë‹¤ì¤‘ í•„í„°

```elixir
filters = %{
  name: %{
    value: "Ali",
    operator: :contains,
    active: true
  },
  age: %{
    value: 25,
    operator: :gte,
    active: true
  },
  created_at: %{
    value: {~D[2024-01-01], ~D[2024-12-31]},
    operator: :between,
    active: true
  }
}
```

#### ë¹„í™œì„± í•„í„°

```elixir
filters = %{
  name: %{
    value: "Alice",
    operator: :contains,
    active: false  # í•„í„° ê°’ì€ ìœ ì§€í•˜ë˜ ì ìš©í•˜ì§€ ì•ŠìŒ
  }
}
```

---

## Sort State êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type sort_state :: %{
  field: atom(),
  direction: :asc | :desc,
  
  # ë‹¤ì¤‘ ì •ë ¬ (í–¥í›„ ì§€ì›)
  secondary: list(sort_item()) | nil
}

@type sort_item :: %{
  field: atom(),
  direction: :asc | :desc
}
```

### ì˜ˆì‹œ

#### ë‹¨ì¼ ì •ë ¬

```elixir
sort = %{
  field: :name,
  direction: :asc,
  secondary: nil
}
```

#### ë‹¤ì¤‘ ì •ë ¬ (v0.3 ì˜ˆì •)

```elixir
sort = %{
  field: :company,
  direction: :asc,
  secondary: [
    %{field: :department, direction: :asc},
    %{field: :name, direction: :desc}
  ]
}
```

---

## Selection State êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type selection_state :: %{
  mode: selection_mode(),
  selected_ids: list(any()),
  
  # ë²”ìœ„ ì„ íƒ (Shift + í´ë¦­)
  anchor_id: any() | nil,
  
  # ì „ì²´ ì„ íƒ ìƒíƒœ
  select_all: boolean()
}

@type selection_mode ::
  :none |        # ì„ íƒ ë¶ˆê°€
  :single |      # ë‹¨ì¼ ì„ íƒ
  :multiple      # ë‹¤ì¤‘ ì„ íƒ
```

### ì˜ˆì‹œ

#### ì„ íƒ ì—†ìŒ

```elixir
selection = %{
  mode: :none,
  selected_ids: [],
  anchor_id: nil,
  select_all: false
}
```

#### ë‹¨ì¼ ì„ íƒ

```elixir
selection = %{
  mode: :single,
  selected_ids: [3],
  anchor_id: nil,
  select_all: false
}
```

#### ë‹¤ì¤‘ ì„ íƒ

```elixir
selection = %{
  mode: :multiple,
  selected_ids: [1, 3, 5],
  anchor_id: 1,
  select_all: false
}
```

#### ì „ì²´ ì„ íƒ

```elixir
selection = %{
  mode: :multiple,
  selected_ids: [1, 2, 3, 4, 5],  # ëª¨ë“  í–‰ ID
  anchor_id: nil,
  select_all: true
}
```

---

## Pagination State êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type pagination_state :: %{
  current_page: pos_integer(),
  page_size: pos_integer(),
  total_rows: non_neg_integer(),
  
  # ê³„ì‚°ëœ ê°’ (ë™ì )
  total_pages: pos_integer(),
  start_index: non_neg_integer(),
  end_index: non_neg_integer(),
  
  # ì˜µì…˜
  show_page_size_selector: boolean(),
  page_size_options: list(pos_integer())
}
```

### ì˜ˆì‹œ

```elixir
pagination = %{
  current_page: 2,
  page_size: 20,
  total_rows: 157,
  
  # ê³„ì‚°ë¨
  total_pages: 8,        # ceil(157 / 20)
  start_index: 20,       # (2 - 1) * 20
  end_index: 39,         # min(20 + 20 - 1, 157 - 1)
  
  show_page_size_selector: true,
  page_size_options: [10, 20, 50, 100]
}
```

### ê³„ì‚° ë¡œì§

```elixir
defmodule LiveViewGrid.Pagination do
  def compute(state, total_rows) do
    total_pages = ceil(total_rows / state.page_size)
    start_index = (state.current_page - 1) * state.page_size
    end_index = min(start_index + state.page_size - 1, total_rows - 1)
    
    %{state |
      total_rows: total_rows,
      total_pages: total_pages,
      start_index: start_index,
      end_index: end_index
    }
  end
end
```

---

## Format Spec êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type format_spec ::
  text_format() |
  number_format() |
  date_format() |
  boolean_format() |
  custom_format()

@type text_format :: %{
  type: :text,
  max_length: pos_integer() | nil,
  truncate: boolean()
}

@type number_format :: %{
  type: :number,
  decimals: non_neg_integer(),
  prefix: String.t() | nil,
  suffix: String.t() | nil,
  thousand_separator: String.t(),
  decimal_separator: String.t()
}

@type date_format :: %{
  type: :date,
  pattern: String.t(),  # "YYYY-MM-DD", "MM/DD/YYYY", etc.
  locale: String.t()    # "ko", "en", etc.
}

@type boolean_format :: %{
  type: :boolean,
  display: :checkbox | :text | :badge,
  true_text: String.t(),
  false_text: String.t(),
  true_class: String.t() | nil,
  false_class: String.t() | nil
}

@type custom_format :: %{
  type: :custom,
  formatter: (any() -> String.t())
}
```

### ì˜ˆì‹œ

#### ìˆ«ì í¬ë§·

```elixir
%{
  type: :number,
  decimals: 2,
  prefix: "$",
  thousand_separator: ",",
  decimal_separator: "."
}

# ê²°ê³¼: "1,234.56" â†’ "$1,234.56"
```

#### ë‚ ì§œ í¬ë§·

```elixir
%{
  type: :date,
  pattern: "YYYYë…„ MMì›” DDì¼",
  locale: "ko"
}

# ê²°ê³¼: ~D[2024-01-15] â†’ "2024ë…„ 01ì›” 15ì¼"
```

#### ë¶ˆë¦° í¬ë§· (ë±ƒì§€)

```elixir
%{
  type: :boolean,
  display: :badge,
  true_text: "í™œì„±",
  false_text: "ë¹„í™œì„±",
  true_class: "badge-green",
  false_class: "badge-gray"
}
```

---

## Filter Config êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type filter_config ::
  text_filter() |
  number_filter() |
  date_filter() |
  select_filter()

@type text_filter :: %{
  type: :text,
  operators: list(:contains | :equals | :starts_with | :ends_with),
  case_sensitive: boolean(),
  placeholder: String.t() | nil,
  debounce_ms: pos_integer()
}

@type number_filter :: %{
  type: :number,
  operators: list(:eq | :ne | :gt | :gte | :lt | :lte),
  min: number() | nil,
  max: number() | nil,
  step: number() | nil
}

@type date_filter :: %{
  type: :date,
  operators: list(:eq | :ne | :gt | :gte | :lt | :lte | :between),
  min_date: Date.t() | nil,
  max_date: Date.t() | nil
}

@type select_filter :: %{
  type: :select,
  options: list({value :: any(), label :: String.t()}),
  multiple: boolean()
}
```

### ì˜ˆì‹œ

#### í…ìŠ¤íŠ¸ í•„í„° (ë””ë°”ìš´ì‹±)

```elixir
%{
  type: :text,
  operators: [:contains, :equals, :starts_with],
  case_sensitive: false,
  placeholder: "ì´ë¦„ ê²€ìƒ‰...",
  debounce_ms: 300
}
```

#### ìˆ«ì í•„í„° (ë²”ìœ„ ì œí•œ)

```elixir
%{
  type: :number,
  operators: [:eq, :gt, :gte, :lt, :lte],
  min: 0,
  max: 150,
  step: 1
}
```

#### ì„ íƒ í•„í„°

```elixir
%{
  type: :select,
  options: [
    {:active, "í™œì„±"},
    {:inactive, "ë¹„í™œì„±"},
    {:pending, "ëŒ€ê¸°"}
  ],
  multiple: false
}
```

---

## Editor Config êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type editor_config ::
  text_editor() |
  number_editor() |
  date_editor() |
  select_editor() |
  checkbox_editor()

@type text_editor :: %{
  type: :text,
  max_length: pos_integer() | nil,
  pattern: Regex.t() | nil,
  validator: (String.t() -> {:ok, String.t()} | {:error, String.t()})
}

@type number_editor :: %{
  type: :number,
  min: number() | nil,
  max: number() | nil,
  step: number(),
  validator: (number() -> {:ok, number()} | {:error, String.t()})
}

@type date_editor :: %{
  type: :date,
  min_date: Date.t() | nil,
  max_date: Date.t() | nil
}

@type select_editor :: %{
  type: :select,
  options: list({value :: any(), label :: String.t()}),
  allow_custom: boolean()
}

@type checkbox_editor :: %{
  type: :checkbox,
  true_value: any(),
  false_value: any()
}
```

### ì˜ˆì‹œ

#### í…ìŠ¤íŠ¸ ì—ë””í„° (ê²€ì¦)

```elixir
%{
  type: :text,
  max_length: 50,
  pattern: ~r/^[a-zA-Z\s]+$/,
  validator: fn value ->
    if String.length(value) > 0 do
      {:ok, value}
    else
      {:error, "ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"}
    end
  end
}
```

#### ìˆ«ì ì—ë””í„°

```elixir
%{
  type: :number,
  min: 0,
  max: 150,
  step: 1,
  validator: fn value ->
    cond do
      value < 0 -> {:error, "0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤"}
      value > 150 -> {:error, "150 ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤"}
      true -> {:ok, value}
    end
  end
}
```

---

## Editing State êµ¬ì¡°

### íƒ€ì… ì •ì˜

```elixir
@type editing_state :: %{
  row_id: any(),
  field: atom(),
  original_value: any(),
  current_value: any(),
  valid: boolean(),
  error: String.t() | nil
} | nil
```

### ì˜ˆì‹œ

#### í¸ì§‘ ì¤‘

```elixir
editing = %{
  row_id: 3,
  field: :name,
  original_value: "Alice",
  current_value: "Alice Smith",
  valid: true,
  error: nil
}
```

#### ê²€ì¦ ì‹¤íŒ¨

```elixir
editing = %{
  row_id: 3,
  field: :age,
  original_value: 30,
  current_value: 200,
  valid: false,
  error: "150 ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤"
}
```

---

## ë°ì´í„° íë¦„

### 1. ì´ˆê¸° ë¡œë“œ

```
User â†’ LiveView.mount()
  â†’ Grid.new(data, columns, options)
  â†’ assigns.grid = %{...}
  â†’ Render Template
  â†’ Client receives initial HTML
```

### 2. ì •ë ¬

```
User clicks column header
  â†’ phx-click="grid_sort"
  â†’ LiveView.handle_event("grid_sort", params, socket)
  â†’ Grid.sort(data, field, direction)
  â†’ Updated assigns
  â†’ Re-render (only changed parts)
  â†’ Client updates DOM
```

### 3. í•„í„°ë§

```
User types in filter input
  â†’ JavaScript debounce (300ms)
  â†’ phx-change="grid_filter"
  â†’ LiveView.handle_event("grid_filter", params, socket)
  â†’ Grid.filter(data, filters)
  â†’ Updated assigns
  â†’ Re-render
  â†’ Client updates DOM
```

### 4. í˜ì´ì§€ ë³€ê²½

```
User clicks page number
  â†’ phx-click="grid_page_change"
  â†’ LiveView.handle_event("grid_page_change", params, socket)
  â†’ Grid.paginate(data, page, page_size)
  â†’ Updated assigns
  â†’ Re-render
  â†’ Client updates DOM
```

### 5. ì…€ í¸ì§‘

```
User double-clicks cell
  â†’ phx-click="grid_cell_edit_start"
  â†’ assigns.grid.state.editing = %{row_id, field, ...}
  â†’ Show input field
  
User types new value
  â†’ phx-change="grid_cell_edit_change"
  â†’ Validate value
  â†’ Update editing.current_value
  
User presses Enter
  â†’ phx-keydown="grid_cell_edit_submit"
  â†’ Grid.update_cell(grid, row_id, field, value)
  â†’ Database update (if applicable)
  â†’ assigns.grid.state.editing = nil
  â†’ Re-render
```

---

## ì™„ì „í•œ ì˜ˆì‹œ

### ì´ˆê¸° Grid Assigns

```elixir
socket.assigns.grid = %{
  id: "users_grid",
  version: "0.1.0",
  
  raw_data: [
    %{id: 1, name: "Alice", age: 30, email: "alice@example.com", active: true},
    %{id: 2, name: "Bob", age: 25, email: "bob@example.com", active: false},
    %{id: 3, name: "Charlie", age: 35, email: "charlie@example.com", active: true}
  ],
  
  data: [
    %{id: 1, name: "Alice", age: 30, email: "alice@example.com", active: true},
    %{id: 2, name: "Bob", age: 25, email: "bob@example.com", active: false},
    %{id: 3, name: "Charlie", age: 35, email: "charlie@example.com", active: true}
  ],
  
  columns: [
    %{
      field: :id,
      label: "ID",
      width: 80,
      align: :right,
      visible: true,
      frozen: true,
      sortable: true,
      filterable: false,
      editable: false,
      resizable: false
    },
    %{
      field: :name,
      label: "ì´ë¦„",
      width: 150,
      align: :left,
      visible: true,
      frozen: false,
      sortable: true,
      filterable: true,
      editable: true,
      resizable: true,
      filter: %{
        type: :text,
        operators: [:contains, :equals],
        case_sensitive: false,
        placeholder: "ì´ë¦„ ê²€ìƒ‰...",
        debounce_ms: 300
      },
      editor: %{
        type: :text,
        max_length: 50
      }
    },
    %{
      field: :age,
      label: "ë‚˜ì´",
      width: 80,
      align: :right,
      visible: true,
      frozen: false,
      sortable: true,
      filterable: true,
      editable: true,
      resizable: true,
      filter: %{
        type: :number,
        operators: [:eq, :gt, :gte, :lt, :lte],
        min: 0,
        max: 150
      },
      editor: %{
        type: :number,
        min: 0,
        max: 150,
        step: 1
      }
    },
    %{
      field: :email,
      label: "ì´ë©”ì¼",
      width: 200,
      align: :left,
      visible: true,
      frozen: false,
      sortable: true,
      filterable: true,
      editable: true,
      resizable: true
    },
    %{
      field: :active,
      label: "í™œì„±",
      width: 80,
      align: :center,
      visible: true,
      frozen: false,
      sortable: true,
      filterable: true,
      editable: true,
      resizable: false,
      format: %{
        type: :boolean,
        display: :badge,
        true_text: "í™œì„±",
        false_text: "ë¹„í™œì„±",
        true_class: "badge-green",
        false_class: "badge-gray"
      },
      filter: %{
        type: :select,
        options: [
          {true, "í™œì„±"},
          {false, "ë¹„í™œì„±"}
        ],
        multiple: false
      },
      editor: %{
        type: :checkbox,
        true_value: true,
        false_value: false
      }
    }
  ],
  
  state: %{
    sort: nil,
    filters: %{},
    selection: %{
      mode: :multiple,
      selected_ids: [],
      anchor_id: nil,
      select_all: false
    },
    pagination: %{
      current_page: 1,
      page_size: 20,
      total_rows: 3,
      total_pages: 1,
      start_index: 0,
      end_index: 2,
      show_page_size_selector: true,
      page_size_options: [10, 20, 50, 100]
    },
    editing: nil,
    loading: false,
    error: nil
  },
  
  options: %{
    page_size: 20,
    frozen_columns: 1,
    show_header: true,
    show_footer: true,
    selectable: true,
    editable: true
  }
}
```

---

## ë²„ì „ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ì‚¬í•­ |
|------|------|----------|
| v0.1.0 | 2026-02-20 | ì´ˆì•ˆ ì‘ì„± |

---

## ë‹¤ìŒ ë‹¨ê³„

- [ ] ì‹¤ì œ êµ¬í˜„ê³¼ í•¨ê»˜ êµ¬ì¡° ê²€ì¦
- [ ] ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ êµ¬ì¡° ê°œì„ 
- [ ] Virtual Scrollingì„ ìœ„í•œ êµ¬ì¡° ì¶”ê°€
- [ ] íŠ¸ë¦¬ ê·¸ë¦¬ë“œë¥¼ ìœ„í•œ êµ¬ì¡° ì¶”ê°€

ğŸ¾
