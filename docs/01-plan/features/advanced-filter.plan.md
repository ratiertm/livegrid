# F-310: 다중 조건 필터 - 계획서

> **기능 코드**: F-310
> **작성일**: 2026-02-21
> **우선순위**: P2
> **난이도**: 4/5

---

## 1. 목표

현재 단일 텍스트/숫자 필터를 **다중 조건 필터**로 확장하여 사용자가 AND/OR 조건을 조합하고,
필터 조건을 추가/삭제할 수 있는 고급 필터링 UI를 제공한다.

---

## 2. 현재 상태 분석

### 2.1 기존 필터 시스템

| 항목 | 현재 구현 |
|------|----------|
| 필터 모듈 | `LiveViewGrid.Filter` (`lib/liveview_grid/operations/filter.ex`) |
| 필터 데이터 | `state.filters = %{field_atom => "단일 값"}` |
| 필터 타입 | `:text` (부분일치), `:number` (연산자: >, <, >=, <=, =) |
| 전체 검색 | `state.global_search` - 모든 컬럼 대상 검색 |
| 조건 결합 | **AND만 지원** (`Enum.all?`로 모든 필터 동시 적용) |
| UI | 컬럼별 단일 입력 필드 (필터 행) |

### 2.2 개선 필요 사항

1. **OR 조건 미지원**: 현재는 AND만 가능 (이름="Alice" AND 도시="Seoul")
2. **단일 조건만 가능**: 컬럼당 하나의 필터 값만 입력 가능
3. **연산자 선택 없음**: 숫자 필터에서 연산자를 텍스트로 직접 입력 (">30")
4. **필터 그룹 없음**: 복합 조건 구성 불가

---

## 3. 요구사항

### 3.1 기능 요구사항

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| R-01 | 컬럼당 다중 조건 추가 가능 (예: 나이 > 20 AND 나이 < 50) | P0 |
| R-02 | AND/OR 논리 연산자 선택 | P0 |
| R-03 | 연산자 드롭다운 선택 (텍스트: contains, equals, starts_with, ends_with) | P0 |
| R-04 | 연산자 드롭다운 선택 (숫자: =, !=, >, <, >=, <=) | P0 |
| R-05 | 필터 조건 개별 삭제 | P0 |
| R-06 | 필터 조건 전체 초기화 | P1 |
| R-07 | 필터 빌더 UI (모달/패널 형태) | P0 |
| R-08 | 활성 필터 개수 뱃지 표시 | P1 |
| R-09 | 기존 단일 필터 행 호환 유지 | P1 |

### 3.2 비기능 요구사항

| ID | 요구사항 |
|----|---------|
| NR-01 | 1,000행 필터링 < 100ms |
| NR-02 | 기존 API 하위 호환 유지 |
| NR-03 | 필터 UI 모바일 반응형 |

---

## 4. 구현 전략

### 4.1 필터 데이터 구조 변경

**현재:**
```elixir
filters = %{name: "Alice", age: ">30"}
```

**변경:**
```elixir
filters = %{
  logic: :and,  # :and | :or (최상위 논리 연산자)
  conditions: [
    %{field: :name, operator: :contains, value: "Alice"},
    %{field: :age, operator: :gt, value: "30"},
    %{field: :city, operator: :equals, value: "Seoul"}
  ]
}
```

### 4.2 하위 호환 전략

기존 단일 필터 행(필터 인풋)은 **그대로 유지**하되, 내부적으로 새 구조로 변환한다.
- 필터 행 입력 → `%{field: :name, operator: :contains, value: "Alice"}` 자동 변환
- 고급 필터 빌더는 별도 UI로 제공

### 4.3 구현 단계

| Step | 내용 | 예상 소요 |
|------|------|----------|
| 1 | Filter 모듈 확장 (새 데이터 구조 + 연산자) | 30min |
| 2 | Grid state 구조 변경 (하위호환) | 20min |
| 3 | 고급 필터 빌더 UI 구현 | 45min |
| 4 | GridComponent 이벤트 핸들러 추가 | 30min |
| 5 | CSS 스타일링 | 20min |
| 6 | 컴파일 + 테스트 + 브라우저 검증 | 20min |

---

## 5. 연산자 정의

### 5.1 텍스트 연산자

| 연산자 | 코드 | 설명 |
|--------|------|------|
| 포함 | `:contains` | 부분 일치 (기본) |
| 같음 | `:equals` | 정확히 일치 |
| 시작 | `:starts_with` | 문자열 시작 |
| 끝남 | `:ends_with` | 문자열 끝 |
| 비어있음 | `:is_empty` | nil 또는 "" |
| 비어있지않음 | `:is_not_empty` | nil/""이 아님 |

### 5.2 숫자 연산자

| 연산자 | 코드 | 설명 |
|--------|------|------|
| 같음 | `:eq` | = |
| 다름 | `:neq` | != |
| 큼 | `:gt` | > |
| 작음 | `:lt` | < |
| 크거나 같음 | `:gte` | >= |
| 작거나 같음 | `:lte` | <= |

---

## 6. 리스크 및 대응

| 리스크 | 영향 | 대응 |
|--------|------|------|
| 기존 필터 API 깨짐 | 높음 | 하위호환 변환 레이어 구현 |
| 필터 UI 복잡성 | 중간 | 기본 필터 행 유지, 고급은 별도 패널 |
| 성능 저하 | 낮음 | 조건 수 제한 (최대 10개) |

---

## 7. 테스트 시나리오

| ID | 시나리오 |
|----|---------|
| T-01 | 단일 텍스트 필터 contains |
| T-02 | 단일 숫자 필터 > 연산자 |
| T-03 | 다중 조건 AND (2개 이상) |
| T-04 | 다중 조건 OR (2개 이상) |
| T-05 | 조건 추가/삭제 |
| T-06 | 전체 초기화 |
| T-07 | 기존 단일 필터 행 호환 |
| T-08 | 빈 조건 무시 |
| T-09 | 필터 뱃지 개수 표시 |
